---

title: mlseo


keywords: fastai
sidebar: home_sidebar

summary: "Pythonic SEO in JupyterLab"
description: "Pythonic SEO in JupyterLab"
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install mlseo --upgrade</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2><p>Start a new Notebook, preferably in standalone JupyterLab. Then type:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlseo</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
<p>Chase the rabbit.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Gist-of-mlseo">The Gist of mlseo<a class="anchor-link" href="#The-Gist-of-mlseo"> </a></h1><p>This is NOT an SEO Software Suite of the sort that automatically sets up webserver user interfaces for you. This is completely the opposite. This package contains a grab-bag of building-blocks useful for constructing "deliverables" for the field of Search Engine Optimization (SEO), and tries to entice you into coding some Python in JupyterLab Desktop.</p>
<h2 id="Light-&amp;-Breezy-Python">Light &amp; Breezy Python<a class="anchor-link" href="#Light-&amp;-Breezy-Python"> </a></h2><p>The goal is to make expressing such deliverables "light and breezy" by establishing certain good Python (Pythonic) conventions that you can use throrought your data-jockying career. The approach I'm about to show you is <strong><em>perfect</em></strong> for raw-data capture from API-calls, using the arguments of the API-call itself as the database-key to recover the locally stored response. If this sounds like gobbledygook to you right now, just bear with me. You'll get it.</p>
<h2 id="Best-Technique-You've-Never-Heard-Of">Best Technique You've Never Heard Of<a class="anchor-link" href="#Best-Technique-You've-Never-Heard-Of"> </a></h2><p>Use the exact values you fed to the API to fetch the data in the first place as the keys to your database to retreive the data again locally. I just boosted your earning-capacity x2 at least. SQLite3 (part of standard Python) is a gift. The dict API connected to it is a gift. The context-manager ("with <em>something</em> as <em>something</em>") is a gift. Use them.</p>
<p>For example, to crawl 1-page of a site into a local database:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">from</span> <span class="nn">sqlitedict</span> <span class="kn">import</span> <span class="n">SqliteDict</span> <span class="k">as</span> <span class="n">sqldict</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://mikelev.in/&#39;</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="s1">&#39;crawl.db&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
<h2 id="Tuples-As-Composite-Keys-(Unique-Constraints)">Tuples As Composite-Keys (Unique Constraints)<a class="anchor-link" href="#Tuples-As-Composite-Keys-(Unique-Constraints)"> </a></h2><p>If the database key should also contain the <strong>date</strong> of the crawl and a full/partial boolean (True/False), we can use a 3-position tuple. This is better practice than appending strings together, because you can keep dates as real datetime objects and perform date operations on them easily when stepping through records.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://mikelev.in/&#39;</span>
<span class="n">atuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">url</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
<h3 id="Pickling-and-Unpickling">Pickling and Unpickling<a class="anchor-link" href="#Pickling-and-Unpickling"> </a></h3><p>The way tuples become string keys (necessary for sqlitedict) is by a common Python serialization function called <strong><em>pickling</em></strong>. We "pickle" the tuple to make it a string-based dictionary key. We can then iterate through all keys, unpickling the primary key and have it back in its orginal tuple-state as we go.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>


<span class="n">pkl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">unpkl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://mikelev.in/&#39;</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

<span class="n">atuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">now_a_string</span> <span class="o">=</span> <span class="n">pkl</span><span class="p">(</span><span class="n">atuple</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">now_a_string</span><span class="p">)</span>
<span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x80\x04\x95</span><span class="s1">9</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x8c\x08</span><span class="s1">datetime</span><span class="se">\x94\x8c\x04</span><span class="s1">date</span><span class="se">\x94\x93\x94</span><span class="s1">C</span><span class="se">\x04\x07\xe6\x04\x04\x94\x85\x94</span><span class="s1">R</span><span class="se">\x94\x8c\x13</span><span class="s1">https://mikelev.in/</span><span class="se">\x94\x88\x87\x94</span><span class="s1">.&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">unpkl</span><span class="p">(</span><span class="n">now_a_string</span><span class="p">))</span>
<span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;https://mikelev.in/&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
<h3 id="Pickling-Keys-For-Database">Pickling Keys For Database<a class="anchor-link" href="#Pickling-Keys-For-Database"> </a></h3><p>The example below puts the 2 above examples together to save the page-crawl to the database using a pickled tuple as the dictionary key. This is worth contemplating. Composite primary keys are unique constraints, thus naturally preventing duplicate redords from being recorded for the same URL for the same day. This sets the stage for efficient subsequent crawls.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">sqlitedict</span> <span class="kn">import</span> <span class="n">SqliteDict</span> <span class="k">as</span> <span class="n">sqldict</span>


<span class="n">pkl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">unpkl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://mikelev.in/&#39;</span>

<span class="c1"># Data goes in</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="s1">&#39;crawl.db&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="n">tupkey</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">url</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">db</span><span class="p">[</span><span class="n">pkl</span><span class="p">(</span><span class="n">tupkey</span><span class="p">)]</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Data comes out</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="s1">&#39;crawl.db&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">tupkey</span> <span class="ow">in</span> <span class="n">db</span><span class="p">:</span>
        <span class="n">adate</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">full</span> <span class="o">=</span> <span class="n">unpkl</span><span class="p">(</span><span class="n">tupkey</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">adate</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">full</span><span class="p">)</span>
</pre></div>
<h1 id="From-Here">From Here<a class="anchor-link" href="#From-Here"> </a></h1><p>By following the install and how-to-use instructions above, you will be invited to run_me(), thereby initiating the example given here. Do the trick to get the trick. This is top-down education. *POOF* here's a gift. Now look at how that works.</p>
<h1 id="A-Word-About-JupyterLab">A Word About JupyterLab<a class="anchor-link" href="#A-Word-About-JupyterLab"> </a></h1><h2 id="Recovering-pip-installs">Recovering pip installs<a class="anchor-link" href="#Recovering-pip-installs"> </a></h2><p>For now standalone Jupyter has to be reinstalled a lot and its easy to lose your pip-installed packages. For mlseo you can get all the necessary packages back by just typing this into a Code cell:</p>

<pre><code>pip install mlseo --upgrade

</code></pre>
<h2 id="Useful-Dev-Tools">Useful Dev Tools<a class="anchor-link" href="#Useful-Dev-Tools"> </a></h2><p>I also recommend installing nbdev and nb_black if you're doing any development work inside Jupyter:</p>

<pre><code>pip install nb_black
pip install nbdev

</code></pre>
<h2 id="Restart-Kernel-&amp;-Clear-All-Outputs-A-LOT">Restart Kernel &amp; Clear All Outputs A LOT<a class="anchor-link" href="#Restart-Kernel-&amp;-Clear-All-Outputs-A-LOT"> </a></h2><p>And lastly, shortcuts always get deleted between Jupyter reinstalls so here's my most important shortcut. It's always a good time to Restart kernel and clear all outputs.</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;shortcuts&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;command&quot;</span><span class="o">:</span> <span class="s2">&quot;kernelmenu:restart-and-clear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;keys&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;Ctrl Shift R&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;selector&quot;</span><span class="o">:</span> <span class="s2">&quot;body&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>
 

