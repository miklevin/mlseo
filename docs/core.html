---

title: Where Do I Work?


keywords: fastai
sidebar: home_sidebar



nb_path: "00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h1 id="mlseo:-Pythonic-SEO-in-JupyterLab">mlseo: Pythonic SEO in JupyterLab<a class="anchor-link" href="#mlseo:-Pythonic-SEO-in-JupyterLab"> </a></h1>
</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="To-begin:-run_me()">To begin: run_me()<a class="anchor-link" href="#To-begin:-run_me()"> </a></h2>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><h3>Continue running the cells.</h3></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Main-Package">Main Package<a class="anchor-link" href="#Main-Package"> </a></h1><p>The above and below cells constitute the entire mlseo package. You can tell because they are the only cells with the <strong># export</strong> comment at the top. Whereas the above cell just imports a bunch of stuff, the below cell actually uses that stuff in building a bunch of custom functions. Everything other than the above and below cells is just example code (<strong><em>using</em></strong> the mlseo package), documentation and development tools.</p>
<h3 id="Continue-running-the-cells.">Continue running the cells.<a class="anchor-link" href="#Continue-running-the-cells."> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="beep" class="doc_header"><code>beep</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L104" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>beep</code>()</p>
</blockquote>
<p>Causes a beep when run from Jupyter. Useful when running long-running scripts
and you want to walk away and be alerted with a beep when the job is done.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="h1" class="doc_header"><code>h1</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L113" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>h1</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Return text as an HTML-style h1 headline when run from Jupyter.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="h2" class="doc_header"><code>h2</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>h2</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Return text as an HTML-style h2 headline when run from Jupyter.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="h3" class="doc_header"><code>h3</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>h3</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Return text as an HTML-style h3 headline when run from Jupyter.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="h4" class="doc_header"><code>h4</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L137" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>h4</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Return text as an HTML-style h4 headline when run from Jupyter.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="h5" class="doc_header"><code>h5</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L145" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>h5</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Return text as an HTML-style h5 headline when run from Jupyter.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="h6" class="doc_header"><code>h6</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L153" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>h6</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Return text as an HTML-style h6 headline when run from Jupyter.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="from_file" class="doc_header"><code>from_file</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L161" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>from_file</code>(<strong><code>file_name</code></strong>)</p>
</blockquote>
<p>Return Python list loaded from lines in file (load keywords, sites, etc).
Makes loading lists of keywords and URLs from file very easy.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="good_url" class="doc_header"><code>good_url</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L174" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>good_url</code>(<strong><code>url</code></strong>)</p>
</blockquote>
<p>Return input URL if well-formed per urlparse which evals True, Else False.
Makes checking whether you have a good URL very easy. Often used in all() func.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="user_agent" class="doc_header"><code>user_agent</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L190" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>user_agent</code>()</p>
</blockquote>
<p>Return a user-agent at random from external file of user-agents.
Useful for lightweight disguising of http-fetching mechanism.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_apex" class="doc_header"><code>extract_apex</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L205" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_apex</code>(<strong><code>url</code></strong>)</p>
</blockquote>
<p>Return the registered or apex domain of a given good URL. Else return False.
Makes for a good pivot-table column (group by site) or folder save location.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_meta_link" class="doc_header"><code>extract_meta_link</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L323" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_meta_link</code>(<strong><code>html</code></strong>, <strong><code>link_name</code></strong>=<em><code>'canonical'</code></em>)</p>
</blockquote>
<p>Return href attribute of link element where rel attribute has provided value.
Mainly useful for extracting canonical.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_links" class="doc_header"><code>extract_links</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L236" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_links</code>(<strong><code>page</code></strong>, <strong><code>allow_offsite</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return a list of on-site links from provided URL or text.
Useful for site-crawling. Defaults to on-site links for crawling purposes.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_title" class="doc_header"><code>extract_title</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L294" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_title</code>(<strong><code>page</code></strong>)</p>
</blockquote>
<p>Return title from provided URL or text. Useful for figuring out targeted keyword of page.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_meta" class="doc_header"><code>extract_meta</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L306" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_meta</code>(<strong><code>html</code></strong>, <strong><code>meta_name</code></strong>=<em><code>'description'</code></em>)</p>
</blockquote>
<p>Return content attribute from meta element whose name attribute has provided value.
Useful for extracting descriptions and other meta values for analysis.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_meta_link" class="doc_header"><code>extract_meta_link</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L323" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_meta_link</code>(<strong><code>html</code></strong>, <strong><code>link_name</code></strong>=<em><code>'canonical'</code></em>)</p>
</blockquote>
<p>Return href attribute of link element where rel attribute has provided value.
Mainly useful for extracting canonical.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_hx" class="doc_header"><code>extract_hx</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L340" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_hx</code>(<strong><code>page</code></strong>, <strong><code>hx</code></strong>=<em><code>'h1'</code></em>)</p>
</blockquote>
<p>Return headline element from provided URL or text. Defaults to H1.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_body" class="doc_header"><code>extract_body</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L354" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_body</code>(<strong><code>html</code></strong>, <strong><code>lower</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Return text extracted from body element of html.
Useful for looking at page-content with HTML and scripts stripped out.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_stemmed" class="doc_header"><code>extract_stemmed</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L366" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_stemmed</code>(<strong><code>html</code></strong>)</p>
</blockquote>
<p>Return stemmed text extracted from body element of html.
Useful as a preliminary step for keyword analysis.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_url_keywords" class="doc_header"><code>extract_url_keywords</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L380" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_url_keywords</code>(<strong><code>url</code></strong>, <strong><code>stem</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return keyword extracted from URL.
Useful for figuring out what keywords a URL is targeting.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_keywords" class="doc_header"><code>extract_keywords</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L395" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_keywords</code>(<strong><code>response</code></strong>, <strong><code>stem</code></strong>=<em><code>False</code></em>, <strong><code>top</code></strong>=<em><code>10</code></em>, <strong><code>ke_args</code></strong>=<em><code>('en', 3, 0.75, 100, None)</code></em>)</p>
</blockquote>
<p>Return list of target keywords descending by score given an httpx response object.
Useful for figuring out what keywords page-content is targeting.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gsc_guess_site" class="doc_header"><code>gsc_guess_site</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L435" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gsc_guess_site</code>(<strong><code>url</code></strong>)</p>
</blockquote>
<p>Return best site-match in Google Search Console to provided URL.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gsc_url2keyword_query" class="doc_header"><code>gsc_url2keyword_query</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L447" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gsc_url2keyword_query</code>(<strong><code>pagestart_date</code></strong>=<em><code>None</code></em>, <strong><code>end_date</code></strong>=<em><code>None</code></em>, <strong><code>days</code></strong>=<em><code>486</code></em>, <strong><code>days_back</code></strong>=<em><code>4</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gsc_url_query" class="doc_header"><code>gsc_url_query</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L473" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gsc_url_query</code>(<strong><code>url</code></strong>=<em><code>None</code></em>, <strong><code>start_date</code></strong>=<em><code>None</code></em>, <strong><code>end_date</code></strong>=<em><code>None</code></em>, <strong><code>days</code></strong>=<em><code>486</code></em>, <strong><code>days_back</code></strong>=<em><code>4</code></em>)</p>
</blockquote>
<p>Return Google Search Console query to get list of keywords for a URL.
Return keywords for entire site if url left off.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gsc2df" class="doc_header"><code>gsc2df</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L501" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gsc2df</code>(<strong><code>data</code></strong>, <strong><code>dimensions</code></strong>=<em><code>None</code></em>, <strong><code>extras</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Return Pandas DataFrame given standard GSC searchanalytics query.
Dimension columns will be generically named if list not provided.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="df_allout" class="doc_header"><code>df_allout</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L530" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>df_allout</code>(<strong><code>df</code></strong>, <strong><code>name</code></strong>, <strong><code>sql</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Create csv, Excel and SQL output of provided name from provided df.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ga_accounts" class="doc_header"><code>ga_accounts</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L540" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ga_accounts</code>(<strong><code>service</code></strong>=<em><code>None</code></em>, <strong><code>everything</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return a list of Google Analytics Accounts accessible to Google login.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ga_properties" class="doc_header"><code>ga_properties</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L555" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ga_properties</code>(<strong><code>account</code></strong>, <strong><code>service</code></strong>=<em><code>None</code></em>, <strong><code>everything</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return a list of Google Analytics Web Properties accessible to Google login
given an Account ID.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ga_properties_g4" class="doc_header"><code>ga_properties_g4</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L571" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ga_properties_g4</code>(<strong><code>account_id</code></strong>)</p>
</blockquote>
<p>Return a list of Google Analytics G4 Accounts accessible to Google login
given an Account ID.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ga_profiles" class="doc_header"><code>ga_profiles</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L587" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ga_profiles</code>(<strong><code>account</code></strong>, <strong><code>property_id</code></strong>, <strong><code>service</code></strong>=<em><code>None</code></em>, <strong><code>everything</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return a list of Google Analytics Profile IDs accessible to Google login
given an Account and Web Property ID. (aka Views)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ga_everything" class="doc_header"><code>ga_everything</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L608" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ga_everything</code>(<strong><code>service</code></strong>=<em><code>None</code></em>, <strong><code>ga4</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Print and return an object containing all Accoount, Web Property and Profile
IDs accessible to to Google Login.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="inspect_url" class="doc_header"><code>inspect_url</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L643" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>inspect_url</code>(<strong><code>url</code></strong>, <strong><code>site</code></strong>, <strong><code>service</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Return a Google Search Console URL Inspection API response for given URL.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="drop_table" class="doc_header"><code>drop_table</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L655" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>drop_table</code>(<strong><code>db</code></strong>, <strong><code>table</code></strong>)</p>
</blockquote>
<p>Drop SQLite table.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pk_compositor" class="doc_header"><code>pk_compositor</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L663" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pk_compositor</code>(<strong><code>db</code></strong>, <strong><code>table</code></strong>, <strong><code>columns</code></strong>, <strong><code>composite_keys</code></strong>)</p>
</blockquote>
<p>Create SQLite table with composite primary key, especially
useful for transforming SqliteDict key/values to rows &amp; columns.
Easiest way to use is with DataFrame column slices like this:
pk_compositor("file.db", "table", df.columns, df.columns[:2])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pk_inserter" class="doc_header"><code>pk_inserter</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L684" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pk_inserter</code>(<strong><code>db</code></strong>, <strong><code>table</code></strong>, <strong><code>df_lot</code></strong>)</p>
</blockquote>
<p>Insert DataFrame or list of tuples into SQLite table row-by-row.
Useful when using composite primary key to prevent duplicates.
Use after pk_compositor makes table and in place of df.to_sql().
Skips duplicates on try/except rather than attempting Update.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="config2dict" class="doc_header"><code>config2dict</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L712" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>config2dict</code>(<strong><code>fname</code></strong>)</p>
</blockquote>
<p>Return a Python dict of a 1-section .ini file.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_google_search_query" class="doc_header"><code>build_google_search_query</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L731" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_google_search_query</code>(<strong><code>keyword</code></strong>, <strong><code>site</code></strong>=<em><code>None</code></em>, <strong><code>num</code></strong>=<em><code>10</code></em>)</p>
</blockquote>
<p>Return a URL that will perform a Google search for given keyword and optional site.
Useful for scraping Google search results.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_serps" class="doc_header"><code>extract_serps</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L749" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_serps</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>Return list of Google search results from provided "raw" SERP scrape.
Useful for checking whether SERPS actually collected or extracting results.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_me" class="doc_header"><code>run_me</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L779" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_me</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="look" class="doc_header"><code>look</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L789" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>look</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="show_globals" class="doc_header"><code>show_globals</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L799" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>show_globals</code>(<strong><code>docs</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Print every publlic function and object in global namespace with their
API signatures. Optionally display their docstrings.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="enlighten_me" class="doc_header"><code>enlighten_me</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L880" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>enlighten_me</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_me" class="doc_header"><code>save_me</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L905" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_me</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="please_explain" class="doc_header"><code>please_explain</code><a href="https://github.com/miklevin/mlseo/tree/main/mlseo/core.py#L927" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>please_explain</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h1 id="mlseo:-Pythonic-SEO-in-JupyterLab">mlseo: Pythonic SEO in JupyterLab<a class="anchor-link" href="#mlseo:-Pythonic-SEO-in-JupyterLab"> </a></h1>
</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="To-begin:-run_me()">To begin: run_me()<a class="anchor-link" href="#To-begin:-run_me()"> </a></h2>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run_me</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">look</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">httpx</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://mikelev.in/&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">enlighten_me</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}
dir(response)print(response.text)
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_me</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sqlitedict</span> <span class="kn">import</span> <span class="n">SqliteDict</span> <span class="k">as</span> <span class="n">sqldict</span>

<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="s2">&quot;crawl.db&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">please_explain</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}
creds = ohawf.get()  # If you need Google login right away, switch this cell to Code.beep()  # Add a beep to alert you at the end of a process.
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Configuring-with-.ini-files">Configuring with .ini files<a class="anchor-link" href="#Configuring-with-.ini-files"> </a></h1><p>You can configure values right in the Notebook, parse them from the command-line or load them from external files. I like loading them from simple <strong><em>.ini</em></strong> files. You'll find default.ini in the <strong><em>config</em></strong> folder. Copy/paste it to make your own config files and change the file-reference in config2dict("default.ini").</p>
<h3 id="Continue-running-the-cells.">Continue running the cells.<a class="anchor-link" href="#Continue-running-the-cells."> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Set up test URL &amp; config vals&quot;</span><span class="p">)</span>

<span class="n">main_cfg</span> <span class="o">=</span> <span class="n">config2dict</span><span class="p">(</span><span class="s2">&quot;default.ini&quot;</span><span class="p">)</span>


<span class="n">test_url</span> <span class="o">=</span> <span class="n">main_cfg</span><span class="p">[</span><span class="s2">&quot;ga_homepage&quot;</span><span class="p">]</span>
<span class="n">apex</span> <span class="o">=</span> <span class="n">extract_apex</span><span class="p">(</span><span class="n">test_url</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">good_url</span><span class="p">(</span><span class="n">test_url</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">apex</span> <span class="o">==</span> <span class="s2">&quot;mikelev.in&quot;</span>
<span class="n">Path</span><span class="p">(</span><span class="n">apex</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dbfile</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">apex</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">apex</span><span class="si">}</span><span class="s2">.db&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test URL:&quot;</span><span class="p">,</span> <span class="n">test_url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database:&quot;</span><span class="p">,</span> <span class="n">dbfile</span><span class="p">)</span>
<span class="n">fig</span><span class="p">(</span><span class="n">apex</span><span class="p">)</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Output-Folder">Output Folder<a class="anchor-link" href="#Output-Folder"> </a></h2><p>Tabular data gets saved to CSV, XLSX and often SQLite with the df_allout() function. The output folder is named the domain. You can watch files appear in this location. The next cell pops open this location.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Get a single HTTP response...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;A Webpage is being fetched based on the URL in the configuration file.</span>
<span class="s2">A variable named resp is being set to the object that was returned.</span>
<span class="s2">&lt;class &#39;httpx.Response&#39;&gt; represents that object.</span>
<span class="s2">It currently is being held only in memory.&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">test_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">user_agent</span><span class="p">())</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">==</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span>
<span class="n">h2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;resp is a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Fetch links from response text...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;This cell inspects the in-memory resp object for all web-links and puts them into </span>
<span class="s2">a list called &quot;links&quot;. These links are currenly only in-memory.&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="n">links</span> <span class="o">=</span> <span class="n">extract_links</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">h2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Links found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Here&#39;s the first 5:&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Put single HTTP response in database...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;This puts the resp data on the drive. Everything goes into the </span><span class="si">{</span><span class="n">apex</span><span class="si">}</span><span class="s2"> folder. </span>
<span class="s2">Notice how the dictionary key IS the actual URL. URLs make good dictionary keys.&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="n">dbfile</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="s2">&quot;raw_crawl&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="n">test_url</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">dbfile</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}
# WAIT! You do not need to run this. For "old way" demo purpose only.
# Keep this cell set to Raw and use it to reference sequential methods.

h1("Perform syncronous crawl (the old way)")

print("Upside is that it goes directly into database.")
start = time()
with sqldict(dbfile, tablename="raw_crawl") as db:
    for i, link in enumerate(links):
        print(f"{i} ", end="")
        resp = httpx.get(link, headers=user_agent())
        db[link] = resp
        db.commit()
end = time()
print("\nSeconds", end - start)

h3("Done!")
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Asyncronously crawl URLs into memory...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;This cell crawls all the links putting that web content into a list named vals. </span>
<span class="s2">It took a fraction of the time the sequential method (in the Raw cell above) would have taken. </span>
<span class="s2">vals is only in memory. We want to commit it to database ASAP...&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">vals</span> <span class="o">=</span> <span class="k">await</span> <span class="n">async_get_responses</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
<span class="n">h2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seconds: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Commit in-memory crawl to database...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;This cell commits the in-memory crawl to database. The crawl of my site </span>
<span class="s2">was only ~700 pages so putting them all in memory first was okay. For larger crawls</span>
<span class="s2">we would want to chunk it into controlled amounts of ~1000 URLs per concurrent crawl...&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="n">dbfile</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="s2">&quot;raw_crawl&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span>
        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">h2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seconds: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h2</span><span class="p">(</span><span class="s2">&quot;Crawl all newly discovered links...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Crawling an entire site is usually achieved by repeatedly running the same function</span>
<span class="s2">which looks at discovered links that have not yet been crawled, and then crawls them.</span>
<span class="s2">Each time you run this block, more links will be found and crawled. Eventually it&#39;s</span>
<span class="s2">supposed to reach 0 New Links found, at which time the crawl is done...&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="n">dbfile</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="s2">&quot;raw_crawl&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">url</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">links</span> <span class="o">=</span> <span class="n">extract_links</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">not_visited</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">link</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">db</span><span class="p">:</span>
                    <span class="n">not_visited</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="k">await</span> <span class="n">async_get_responses</span><span class="p">(</span><span class="n">not_visited</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vals</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="n">key</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">h2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New Links: </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Seconds:&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Extract error-pages from crawl...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;As it happens, we don&#39;t merely store the &quot;view-source&quot; HTML of the pages. We store</span>
<span class="s2">the entire &quot;response objecet&quot; which includes response headers, response codes and</span>
<span class="s2">more useful info. This outputs all pages with anything other than successful...&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="n">dbfile</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="s2">&quot;raw_crawl&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">url</span><span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">])</span>
    <span class="n">df_allout</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;crawl_errors&quot;</span><span class="p">,</span> <span class="n">sql</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Here&#39;s 5 random errors:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Demonstrate asyncronous functions...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;This step shows how you can use the same async function that did the crawl to run</span>
<span class="s2">any async function that can take a tuple as an input. You feed async_get_responses()</span>
<span class="s2">a list of tuples and an async function and get back a list of results...&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">bar</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>


<span class="n">tuples</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>
<span class="n">tuples_summed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">async_get_responses</span><span class="p">(</span><span class="n">tuples</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input: </span><span class="si">{</span><span class="n">tuples</span><span class="si">}</span><span class="s2">, foo&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output: </span><span class="si">{</span><span class="n">tuples_summed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Extract SEO fields from crawl...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;So far all our work has used sqldict&#39;s which keep all data as key/value pairs</span>
<span class="s2">which is usually in JSON format. This step is the first that &quot;flattens&quot; hierarchial </span>
<span class="s2">data in the easiest way possible. The &quot;table&quot; list is in memory and can get big...&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="n">dbfile</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="s2">&quot;raw_crawl&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">db</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">url</span><span class="p">]</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
        <span class="n">urlkw</span> <span class="o">=</span> <span class="n">extract_url_keywords</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">extract_title</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">extract_meta</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">canonical</span> <span class="o">=</span> <span class="n">extract_meta_link</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">h_1</span> <span class="o">=</span> <span class="n">extract_hx</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">h_2</span> <span class="o">=</span> <span class="n">extract_hx</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;h2&quot;</span><span class="p">)</span>
        <span class="n">c</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;canonical&quot;</span><span class="p">,</span> <span class="s2">&quot;h1&quot;</span><span class="p">,</span> <span class="s2">&quot;h2&quot;</span><span class="p">,</span> <span class="s2">&quot;url_keywords&quot;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="n">df_allout</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;crawl&quot;</span><span class="p">,</span> <span class="n">sql</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Displaying 5 random pages:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Display data from sqlite...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;This Cell simply reads the just-stored &quot;SEO Fields&quot; data back out of the database</span>
<span class="s2">to demonstrate re-creating an in-memory DataFrame from a SQL table...&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

<span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbfile</span><span class="p">))</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">qry</span> <span class="o">=</span> <span class="s2">&quot;select * from crawl;&quot;</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">qry</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
    <span class="n">df_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sql_query</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Displaying 5 random pages:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_out</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">h2</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}
drop_table(dbfile, "crawl_keywords")  # Change from Raw if you want to start fresh
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Analyze keywords from site crawl...&quot;</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;This Cell extracts the most common keywords of each page in the crawled data.</span>
<span class="s2">It&#39;s fairly slow because of the processing it&#39;s doing on each page and should run in</span>
<span class="s2">sequential mode because it&#39;s safer to write to SQLite without concurrency...&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SPACES</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="n">dbfile</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="s2">&quot;raw_crawl&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">url</span><span class="p">]</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
            <span class="n">keywords</span> <span class="o">=</span> <span class="n">extract_keywords</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">url</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">],</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;keyword&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                <span class="n">pkeys</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">pk_compositor</span><span class="p">(</span><span class="n">dbfile</span><span class="p">,</span> <span class="s2">&quot;crawl_keywords&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">pkeys</span><span class="p">)</span>
            <span class="n">pk_inserter</span><span class="p">(</span><span class="n">dbfile</span><span class="p">,</span> <span class="s2">&quot;crawl_keywords&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">creds</span> <span class="o">=</span> <span class="n">ohawf</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gsc_sites</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;siteUrl&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">svc_gsc</span><span class="p">()</span><span class="o">.</span><span class="n">sites</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()[</span><span class="s2">&quot;siteEntry&quot;</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">asite</span> <span class="ow">in</span> <span class="n">gsc_sites</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">asite</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;List all Google Analytics access.&quot;</span><span class="p">)</span>

<span class="n">h4</span><span class="p">(</span><span class="s2">&quot;Classic &amp; UA&quot;</span><span class="p">)</span>
<span class="n">everything</span> <span class="o">=</span> <span class="n">ga_everything</span><span class="p">()</span>
<span class="n">h4</span><span class="p">(</span><span class="s2">&quot;G4 Analytics&quot;</span><span class="p">)</span>
<span class="n">everything_ga4</span> <span class="o">=</span> <span class="n">ga_everything</span><span class="p">(</span><span class="n">ga4</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">h3</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ga_everything</span><span class="p">(</span><span class="n">svc_ga</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

