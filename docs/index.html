---

title: mlseo


keywords: fastai
sidebar: home_sidebar

summary: "Pythonic SEO in JupyterLab"
description: "Pythonic SEO in JupyterLab"
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install mlseo --upgrade</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2><p>Start a new Notebook, preferably in standalone JupyterLab. Then type:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlseo</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

<pre><code> Welcome to _                  (\         To chase the rabbit,
  _ __ ___ | |___  ___  ___     \\_ _/(\      run: look()
 | '_ ` _ \| / __|/ _ \/ _ \      0 0 _\)___
 | | | | | | \__ \  __/ (_) |   =(_T_)=     )*
 |_| |_| |_|_|___/\___|\___/      /"/   (  /
           The adventure begins! &lt;_&lt;_/-&lt;__|</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Most-Important-Things">The Most Important Things<a class="anchor-link" href="#The-Most-Important-Things"> </a></h1><h2 id="Storing-API-Responses-into-Database">Storing API Responses into Database<a class="anchor-link" href="#Storing-API-Responses-into-Database"> </a></h2><p>This package contains a variety of building-blocks for constructing "deliverables" for the field of Search Engine Optimization (SEO). The goal is to make expressing such deliverables "light and breezy" by establishing certain conventions. For example, to crawl 1-page of a site into a local database:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">from</span> <span class="nn">sqlitedict</span> <span class="kn">import</span> <span class="n">SqliteDict</span> <span class="k">as</span> <span class="n">sqldict</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://mikelev.in/&#39;</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="s1">&#39;crawl.db&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="n">db</span><span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
<h2 id="Using-Tuples-As-Composite-Keys">Using Tuples As Composite-Keys<a class="anchor-link" href="#Using-Tuples-As-Composite-Keys"> </a></h2><p>We are using SQlite as a key-value database in a way that requires the keys to be strings. Keys must be unique so if we use the URL as the key we can store each page we crawl only once. Instead of just a URL, the key to your database can contain a URL and Date so that we can crawl sites on subsequent days and store it into the same key-value database. Such a tuple key looks like this:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://mikelev.in/&#39;</span>
<span class="n">atuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
<h2 id="Pickling-and-Unpickling">Pickling and Unpickling<a class="anchor-link" href="#Pickling-and-Unpickling"> </a></h2><p>Tuples must become strings to be a key in the key-value database we're using. This is accomplished through <strong><em>pickling</em></strong>. We "pickle" the tuple to make it a string, then can use that string as a key in the dictionary database.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="n">pkl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">unpkl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://mikelev.in/&#39;</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">atuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

<span class="n">now_a_string</span> <span class="o">=</span> <span class="n">pkl</span><span class="p">(</span><span class="n">atuple</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now_a_string</span><span class="p">)</span>
</pre></div>
<h3 id="Pickling-Keys-For-Database">Pickling Keys For Database<a class="anchor-link" href="#Pickling-Keys-For-Database"> </a></h3><p>This example uses a pickled tuple containing the Date and the URL as the database key. It shows data both going in and coming out of the database. Notice the pickled key is restored to its original form. This approach prevents duplicate records in your database. Because dictionary keys must be unique, attempts to insert a new record with the same URL+Date key will fail, meaning this crawler can only record each page on the site once per day. This is a good thing. It's what databases are for.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">sqlitedict</span> <span class="kn">import</span> <span class="n">SqliteDict</span> <span class="k">as</span> <span class="n">sqldict</span>


<span class="n">pkl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">unpkl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://mikelev.in/&#39;</span>

<span class="c1"># Data goes in</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="s1">&#39;crawl.db&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="n">tupkey</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">url</span><span class="p">)</span>
    <span class="n">db</span><span class="p">[</span><span class="n">pkl</span><span class="p">(</span><span class="n">tupkey</span><span class="p">)]</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Data comes out</span>
<span class="k">with</span> <span class="n">sqldict</span><span class="p">(</span><span class="s1">&#39;crawl.db&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">tupkey</span> <span class="ow">in</span> <span class="n">db</span><span class="p">:</span>
        <span class="n">adate</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">unpkl</span><span class="p">(</span><span class="n">tupkey</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">adate</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
<h1 id="From-Here">From Here<a class="anchor-link" href="#From-Here"> </a></h1><p>At this point you should understand that we're using Python's built-in SQLite database like a standard Python key-value dictionary (dict) and that we are able to use pickled tuples as keys, which maintains data integrity because db keys must be unique. All mlseo projects build on this technique. You might like <a href="https://sqlitebrowser.org/">DB Browser for SQLite</a>  to open and inspect the .db files another way.</p>
<h1 id="mlseo-Tutorials">mlseo Tutorials<a class="anchor-link" href="#mlseo-Tutorials"> </a></h1><p><a href="./housekeeping.ipynb"><strong>HOUSEKEEPING:</strong></a> Once you have the basic trick of using a persistent dictionary and using tuples as your primary key, you'll need a place to <strong><em>put</em></strong> the database and all your other INPUT/OUTPUT files besides lumping it all into the top-level of your folder.</p>
<h2 id="A-Word-About-JupyterLab">A Word About JupyterLab<a class="anchor-link" href="#A-Word-About-JupyterLab"> </a></h2><h3 id="Recovering-pip-installs">Recovering pip installs<a class="anchor-link" href="#Recovering-pip-installs"> </a></h3><p>For now standalone Jupyter has to be reinstalled a lot and its easy to lose your pip-installed packages. For mlseo you can get all the necessary packages back by just typing this into a Code cell:</p>

<pre><code>pip install mlseo --upgrade

</code></pre>
<h3 id="Useful-Dev-Tools">Useful Dev Tools<a class="anchor-link" href="#Useful-Dev-Tools"> </a></h3><p>I also recommend installing nbdev and nb_black if you're doing any development work inside Jupyter:</p>

<pre><code>pip install nb_black
pip install nbdev

</code></pre>
<h3 id="Restart-Kernel-&amp;-Clear-All-Outputs-A-LOT">Restart Kernel &amp; Clear All Outputs A LOT<a class="anchor-link" href="#Restart-Kernel-&amp;-Clear-All-Outputs-A-LOT"> </a></h3><p>And lastly, shortcuts always get deleted between Jupyter re-installs so here's my most important shortcut. It's always a good time to Restart kernel and clear all outputs.</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;shortcuts&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;command&quot;</span><span class="o">:</span> <span class="s2">&quot;kernelmenu:restart-and-clear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;keys&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;Ctrl Shift R&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;selector&quot;</span><span class="o">:</span> <span class="s2">&quot;body&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>nb_nb2md<span class="o">(</span><span class="s1">&#39;index.ipynb&#39;</span><span class="o">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&#39;nb_nb2md&#39; is not recognized as an internal or external command,
operable program or batch file.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>


